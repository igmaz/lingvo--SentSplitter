$(document).ready(function () {
    var MAX_INPUTTEXT_LENGTH  = 100000,
        LOCALSTORAGE_TEXT_KEY = 'ss-text',
        DEFAULT_TEXT = 'Theodore Robert Bundy (born Theodore Robert Cowell; November 24, 1946 – January 24, 1989) was an American serial killer, kidnapper, rapist, and necrophile who assaulted and murdered numerous young women and girls during the 1970s and possibly earlier. Shortly before his execution, after more than a decade of denials, he confessed to 30 homicides committed in seven states between 1974 and 1978. The true victim count remains unknown, and could be much higher. Bundy was regarded as handsome and charismatic by many of his young female victims, traits he exploited to win their trust. He typically approached them in public places, feigning injury or disability, or impersonating an authority figure, before overpowering and assaulting them at more secluded locations. He sometimes revisited his secondary crime scenes for hours at a time, grooming and performing sexual acts with the decomposing corpses until putrefaction and destruction by wild animals made further interaction impossible. He decapitated at least 12 of his victims, and kept some of the severed heads in his apartment for a period of time as mementos. On a few occasions, he simply broke into dwellings at night and bludgeoned his victims as they slept. Initially incarcerated in Utah in 1975 for aggravated kidnapping and attempted criminal assault, Bundy became a suspect in a progressively longer list of unsolved homicides in multiple states. Facing murder charges in Colorado, he engineered two dramatic escapes and committed further assaults, including three murders, before his ultimate recapture in Florida in 1978. He received three death sentences in two separate trials for the Florida homicides. Bundy died in the electric chair at Raiford Prison in Starke, Florida, on January 24, 1989. Biographer Ann Rule described him as "... a sadistic sociopath who took pleasure from another human\'s pain and the control he had over his victims, to the point of death, and even after." He once called himself "... the most cold-hearted son of a bitch you\'ll ever meet." Attorney Polly Nelson, a member of his last defense team, agreed. "Ted," she wrote, "was the very definition of heartless evil."';
                        //'Отец — Ал. Ал. Медведев (род. 19 ноября 1926—2004), проф. Ленинградского технологического института им. Ленсовета (ныне Санкт-Петербургский государственный технологический институт). Потомок крестьян Курской губернии[!], член ВКП(б) с 1952 г.Дед А. Ф. Медведев (умер 20 мая 1994 г.) был партийным работником с 1933 г., с 1946 по 1951 гг. работал первым секретарём райкома партии Павловского р. (Краснодарский кр.), с 1955 по 1958 год был секретарём Кореновского райкома КПСС в г. Кореновск, далее работал инструктором в Краснодарском крайкоме...Бабушка Надежда Васильевна Медведева была домохозяйкой, воспитывала детей: Светлану и Анатолия, умерла 24 мая 1990 г.Мать — Ю. В.  (род. 21 ноября 1939 года), дочь В. С. Шапошникова и М.В.Ковалёвой[?]; фил., к.ф.н., преподавала в Педагогическом институте им.  А. И. Герцена, позже работала экскурсоводом в Павловске.Ноль шкалы Цельсия установлен таким образом, что температура тройной точки воды равна 0,01 °C. В итоге, шкалы Цельсия и Кельвина сдвинуты на 273,15.Шкала Цельсия линейна в интервале от 0 до 100° и также линейно продолжается в области ниже 0° и выше 100° С. Линейность является основной проблемой при точных измерениях температуры.Людо́вик XVI (23 августа 1754 — 21 января 1793) — король Франции из династии Бурбонов, сын дофина Людовика Фердинанда, наследовал своему деду Людовику XV.Людовик сначала принял конституцию 1791 года, отказался от абсолютизма и стал конституционным монархом, однако вскоре начал нерешительно противодействовать радикальным мерам революционеров и пр. 21 сентября 1792 низложен, предан суду Конвента и вскоре казнён на гильотине.9 сентября 2009 года для Москвы начал действовать сервис Яндекс.Панорамы. Позже панорамы стали доступны для других городов. Она вскрикнула: «Ай, не он, не он!» – и упала без памяти (Пушкин).Форму знаменитой бутылки-графина, напоминающей виноградный лист, изобрел представитель шестого поколения семейства Хеннесси. В середине XIX века Моррис Хеннесси предложил использовать звездочки для обозначения выдержки: так возник коньяк «***», которые сегодня заменили литеры V.S. Первые в мире коньяки категории V.S.O.P. и X.O. были изготовлены Домом Hennessy в 1817 и 1870 годах.В 1817 году Правящий Принц, будущий король Англии Георг IV, заказывает Дому Хеннесси «старый коньячный спирт светлой окраски, исключительного качества», в английском написании «a verysuperioroldpalecognaceaux-de-vie» или V.S.O.P.Эта марка быстро становится популярной и покоряет весь мир. Hennessy V.S.O.P. Privilege - это традиционный ассамбляж более 60-ти коньячных спиртов из вин четырех наиболее плодородных областей региона Коньяк. Э.ван дер Сар является рекордсменом сборной Нидерландов по количеству сыгранных матчей, хотя дебютировал с ней довольно поздно. В 1994 г. Эн ван дер Сар ездил в составе национальной сборной на чемпионат мира в США и т.д.Другой представитель этого рода, биолог, настаивает, чтобы его назвали князь Александр фон Ливен.Т.о.,  алгоритм должен работать, т.е. хорошо разделать текст на предложения :) А вы что думали?Ах. Как хороши и свежи были розы. Эх… Чего теперь об этом говорить :(Уровень воды 5 м. Это не мало для прыжков с размаху :DЧистая прибыль Сбербанк по РСБУ за 8 месяцев 2012г. увеличилась на 6 % - до 239.4 млрд руб.М. Речной вокзал. топала в гости.У Московский вокзала небольшие, но очень удобные комнаты в недорогом хостеле "SuperHostel" на Гончарной 15А, 2000 руб./номер с удобствами!Можно провести струнную дорогу от Речного вокзала в Кольцово, Академгородок и Бердск, предельная скорость - 500 км./ч.Пускай сначала наведет порядок на Курском вокзале а то блоггеров Белгородских натравим.)) Электричка с Балтийский вокзал в 13:40. Сбор у Mail.ru Продам 1 кв. в Нижнем Новгороде в 10 минутах ходьбы от московский вокзал вопросы в личку. Всем приветики) я наконец то выспалась, что сказывается на хорошем настроении и улучшенном  речной вокзал.Это и речной вокзал закрыли?? Вообще как пройти к набережной теперь? ой, мне пожизненно кто-то пускает!Всего 50 предложений!!!  В 2012г. АвтоВАЗ планирует выпустить порядка 10 тыс. автомобилей LADA Granta , оснащенных коробкой " автомат " , в 2013г. – уже более 70 тыс . ОАО " ЭМАльянс " и Integro Ltd ( Греция ) подписали договор на 260 тыс. евро по реконструкции ТЭС " Керацини " общей установленной мощностью 200 МВт. Об этом говорится в сообщении ЭМАльянса. По его словам , на данный момент к севу озимых приступили хозяйства Прикубанского , Адыге-Хабльского и Ногайского районов КЧР . Посеяно около 500 га пшеницы и 3,2 тыс. га рапса.  " Вагонмаш " является одним из старейших вагоностроительных предприятий РФ . С 2003 г. компания входит в группу " Дедал ". НОВАТЭК - второй после Газпрома производитель природного газа в РФ . Доказанные запасы углеводородов по классификации SEC по состоянию на 31 декабря 2009 года увеличились на 38.1% до 6. 853 млрд баррелей нефтяного эквивалента . Ее комплекс – это десять громадных корпусов , некоторые из них длиной более 130 м. Построят здесь и свой железнодорожный узел - станцию Промышленная . Основав в том же году ювелирный Дом своего имени , Картье развернулся так , что вскоре уже числился поставщиком двора Наполеона III .  В состав ТГК-5 входят 11 ТЭЦ Чувашской и Удмуртской республик , Кировской области и республики Марий Эл . Установленная мощность по электрической энергии составляет 2 тыс. 467,3 МВт , по теплу - 9,04 тыс . Стандарт LTE в два-пять раз более эффективен в использовании частотного диапазона при передаче данных , чем 3G . Но , как следует из исследования Cisco , это не покрывает потребностей пользователей . Теннисный турнир пройдет при поддержке администрации г. Кемерова . В октябре  будет представлен межвузовский чемпионат по игре «Что ? Где? Когда?». Открытый конкурс 14.05.09-163-ОК.  Но , тем не менее , недостатки и нарушения были , как будто , устранены , и новая дата была назначена на 25 сентября , хотя еще оставались вопросы к Нурову и руководству регионального отделения КПРФ . Однако они спешили , а почему станет ясно позднее . Зарубежные власти уже давно четко дали понять , что не считают " Роснефть " добропорядочным приобретателем активов ЮКОСа . И российской компании , так или иначе , придется с этим считаться при осуществлении своей деятельности и работать в этом направлении.'

    var textOnChange = function () {
        let len = $('#text').val().length, len_txt = len.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        $('#textLength').toggleClass('max-inputtext-length', MAX_INPUTTEXT_LENGTH < len).html('length of text: ' + len_txt + ' characters');
    };
    var getText = function( $text ) {
        var text = trim_text( $text.val().toString() );
        if (is_text_empty(text)) {
            alert('Enter the text to be processed.');
            $text.focus();
            return (null);
        }
        
        if (text.length > MAX_INPUTTEXT_LENGTH) {
            if (!confirm('Exceeded the recommended limit ' + MAX_INPUTTEXT_LENGTH + '  characters (on the ' + (text.length - MAX_INPUTTEXT_LENGTH) + ' characters).\r\nText will be truncated, continue?')) {
                return (null);
            }
            text = text.substr(0, MAX_INPUTTEXT_LENGTH);
            $text.val(text);
            $text.change();
        }
        return (text);
    };

    $('#text').focus(textOnChange).change(textOnChange).keydown(textOnChange).keyup(textOnChange).select(textOnChange).focus();

    (function () {
        function isGooglebot() { return (navigator.userAgent.toLowerCase().indexOf('googlebot/') !== -1); };
        if (isGooglebot()) return;

        var text = localStorage.getItem(LOCALSTORAGE_TEXT_KEY);
        if (!text || !text.length) text = DEFAULT_TEXT;
        $('#text').val(text).focus();
    })();
    $('#resetText2Default').click(function () {
        $('#text').val('');
        setTimeout(() => $('#text').val(DEFAULT_TEXT).focus(), 100);
    });

    $('#processButton').click(function () {
        if($(this).hasClass('disabled')) return (false);

        var text = getText( $('#text') );
        if (!text) return (false);

        processing_start();
        if (text !== DEFAULT_TEXT) {
            localStorage.setItem(LOCALSTORAGE_TEXT_KEY, text);
        } else {
            localStorage.removeItem(LOCALSTORAGE_TEXT_KEY);
        }

        var model = {
            text: text
        };
        $.ajax({
            type       : 'POST',
            contentType: 'application/json',
            dataType   : 'json',
            url        : '/Process/Run',
            data       : JSON.stringify( model ),
            success: function (responce) {
                if (responce.err) {
                    processing_end();
                    $('.result-info').addClass('error').text(responce.err);
                } else {
                    if (responce.sents && responce.sents.length) {
                        $('.result-info').removeClass('error').text('');
                        var trs = [];
                        for (var i = 0, len = responce.sents.length; i < len; i++) {
                            trs.push( '<tr><td>' + (i + 1) + '.</td><td>' + responce.sents[ i ].text + '</td></tr>' );
                        }
                        setTimeout( () => $('#processResult tbody').html( trs.join('') ), 100 );
                        //$('#processResult tbody').html( trs.join('') );
                        processing_end();
                        $('.result-info').hide();
                    } else {
                        processing_end();
                        $('.result-info').text('Borders of a sentence are not defined in the text');
                    }
                }
            },
            error: function () {
                processing_end();
                $('.result-info').text('ошибка сервера');
            }
        });
    });

    function processing_start(){
        $('#text').addClass('no-change').attr('readonly', 'readonly').attr('disabled', 'disabled');
        $('.result-info').show().removeClass('error').html('Processing... <label id="processingTickLabel"></label>');
        $('#processButton').addClass('disabled');
        $('#processResult tbody').empty();
        processingTickCount = 1; setTimeout(processing_tick, 1000);
    };
    function processing_end(){
        $('#text').removeClass('no-change').removeAttr('readonly').removeAttr('disabled');
        $('.result-info').removeClass('error').text('');
        $('#processButton').removeClass('disabled');
    };
    function trim_text(text) { return (text.replace(/(^\s+)|(\s+$)/g, '')); };
    function is_text_empty(text) { return (!trim_text(text)); };

    var processingTickCount,
        processing_tick = function () {
            var n2 = function (n) {
                n = n.toString();
                return ((n.length === 1) ? ('0' + n) : n);
            }
            var d = new Date(new Date(new Date(new Date().setHours(0)).setMinutes(0)).setSeconds(processingTickCount));
            var t = n2(d.getHours()) + ':' + n2(d.getMinutes()) + ':' + n2(d.getSeconds()); //d.toLocaleTimeString();
            var $s = $('#processingTickLabel');
            if ($s.length) {
                $s.text(t);
                processingTickCount++;
                setTimeout(processing_tick, 1000);
            } else {
                processingTickCount = 1;
            }
        };
});
